> Model training is required before the model prediction that produces
> the classified map. For Model training in FORCE, we can use either the
> Random Forest (RF) classifier or Support Vector Machine classifier (SVM). This step will produce a modelset for each response variable as an .xml file.

For this workflow, we will use an RF classifier. You can use SVM too, by changing it in the parameter file.

<br>

#### Table of contents

- [Step 1: Make the necessary directories](#step-1-make-the-necessary-directories)
- [Step 2: Create the parameter file](#step-2-create-the-parameter-file)
- [Step 3: Fill up the parameter file](#step-3-fill-up-the-parameter-file)
- [Step 4: Create the required number of parameter files from the filled-up template parameter file](#step-4-create-the-required-number-of-parameter-files-from-the-filled-up-template-parameter-file)
- [Step 5: Train the models](#step-5-train-the-models)
- [Troubleshooting](#troubleshooting)

<br>

## Step 1: Make the necessary directories

If using the example files from this workflow, you can skip this step.

<br>

*In Linux:*

Create the output directory:<br>
`sudo docker run -it -v /home/GIS/force:/data davidfrantz/force mkdir /data/train_RFC`

Create the parameter directory: <br>
`sudo docker run -it -v /home/GIS/force:/data davidfrantz/force mkdir /data/train_parameters_RFC`

<br>

*In Windows:*

Create the output directory:<br>
`podman run -it --user root -v "C:\Users\GIS:/home/docker/force" davidfrantz/force mkdir /home/docker/force/force/train_RFC`

Create the parameter directory: <br>
`podman run -it --user root -v "C:\Users\GIS:/home/docker/force" davidfrantz/force mkdir /home/docker/force/force/train_parameters_RFC`

<br>

## Step 2: Create the parameter file

<br>

*In Linux:*

`sudo docker run -it -v /home/GIS/force:/data davidfrantz/force force-parameter /data/parameter_train_RFC.prm TRAIN`

<br>

*In Windows:*

`podman run -it -v "C:\Users\GIS:/home/docker/force" davidfrantz/force force-parameter /home/docker/force/force/parameter_train_RFC.prm TRAIN`

<br>

## Step 3: Fill up the parameter file

<br>

## Step 4: Create the required number of parameter files from the filled-up template parameter file

For this step, we will use the `force-magic-parameters` program see the [official FORCE documentation here][1]). The following text should be there on the first row of the parameter file:

```
%SET%: 001 002 003 004 005 006 007 008 009 010 011 012
```
So, if there are 12 classes, then 12 different parameter files will be created. 

Example files for both Linux and Windows can be found under the "Files" section of this component ("Model Training"). Remove the suffix _Linux or _Windows from this file to use with this current workflow.

*In Linux:*

`sudo docker run -it -v /home/GIS/force:/data davidfrantz/force force-magic-parameters -o /data/train_parameters /data/parameter_train_RFC.prm`

`[sudo] password for birdlab:`

Output:
```
1 replacement vectors detected
12 parameter files were generated
```

*In Windows:*

`podman run -it --user root -v "C:\Users\GIS:/home/docker/force" davidfrantz/force force-magic-parameters -o /home/docker/force/force/train_parameters_RFC /home/docker/force/force/parameter_train_RFC.prm`

Output:
```
1 replacement vectors detected
12 parameter files were generated
```
<br>

## Step 5: Train the models

<br>

*In Linux:*

`sudo docker run -it -v /home/GIS/force:/data davidfrantz/force bash -c 'for f in /data/train_parameters_RFC/*.prm; do force-train "$f"; done'`

<br>

*In Windows:*

`podman run -it -v "C:\Users\GIS:/home/docker/force" davidfrantz/force bash -c 'for f in /home/docker/force/force/train_parameters_RFC/*.prm; do force-train "$f"; done'`

The train_RFC folder will look like the following after this:

![enter image description here][2]

The log files will contain the Overall Accuracy (OA) calculated by the program for the respective classes.

<br>

## Troubleshooting

When running the following code suggested [in a official FORCE tutorial][3] in step 5 will result in an error:

`podman run -it -v "C:\Users\GIS:/home/docker/force" davidfrantz/force for f in /home/docker/force/force/train_parameters_RFC/*.prm; do dforce force-train $f; done`

Output:
```
At line:1 char:148
+ ...  for f in /home/docker/force/force/train_parameters/*.prm; do dforce  ...
+                                                                  ~
Missing statement body in do loop.
    + CategoryInfo          : ParserError: (:) [], ParentContainsErrorRecordException
    + FullyQualifiedErrorId : MissingLoopStatement
```
The error occurs because I was trying to run a Bash-style for loop directly in PowerShell, which doesn't work. Podman expects the command after the image name (davidfrantz/force) to be in a format that the container's shell can execute.

Solution: Use `bash -c` to Run the Loop Inside the Container (as shown step 5)

Also, there is no command called `dforce` (It seems to be a defined function somewhere in the FORCE documentation).


  [1]: https://force-eo.readthedocs.io/en/latest/components/auxilliary/magic-parameters.html#force-magic-parameters
  [2]: https://i.ibb.co/Ps56XZH7/file-structure.png
  [3]: https://force-eo.readthedocs.io/en/latest/howto/lcf.html#model-training
